<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>RFEM Speaker PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: white;
}

/* HEADER */
header {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 16px;
  padding: 14px;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(8px);
}

.logo {
  height: 50px;
  opacity: 0.9;
}

/* BOTONES */
button {
  background: #00d1ff;
  border: none;
  padding: 12px 16px;
  font-size: 15px;
  font-weight: bold;
  border-radius: 12px;
  cursor: pointer;
  transition: 0.2s;
}
button:hover { transform: scale(1.05); background:#00b4dd; }

.search-box {
  padding: 10px 14px;
  border-radius: 12px;
  border: none;
  min-width: 220px;
}

/* TITULOS */
.section-title {
  text-align: center;
  margin: 20px 0 10px;
  font-size: 24px;
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
  gap: 14px;
  padding: 20px;
}

.card {
  background: rgba(20,30,60,0.9);
  border-radius: 16px;
  padding: 12px;
  text-align: center;
  transition: 0.2s;
}
.card:hover { transform: scale(1.05); }

.en-pista {
  border: 3px solid #00ff00;
  box-shadow: 0 0 15px #00ff00;
}

.card img {
  width: 100%;
  height: 140px;
  object-fit: cover;
  border-radius: 12px;
}

/* OVERLAYS */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.95);
  display: none;
  overflow-y: auto;
  padding: 20px;
  z-index: 1000;
}

input, select, textarea {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 10px;
  border: none;
  font-size: 15px;
}

textarea { resize: vertical; min-height: 80px; }

/* TIMELINE */
.timeline {
  display: flex;
  gap: 12px;
  overflow-x: auto;
}

.timeline-item {
  min-width: 200px;
  background: #111;
  padding: 10px;
  border-radius: 10px;
  box-shadow: 0 0 8px #00d1ff;
}
</style>
</head>

<body>

<header>
  <img class="logo" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjUwIiB2aWV3Qm94PSIwIDAgMTAwIDUwIiBmaWxsPSJ3aGl0ZSI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSI1MCIgZmlsbD0iIzAwZDFmZiIvPjx0ZXh0IHg9IjUwIiB5PSIzMiIgZm9udC1zaXplPSIyMCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmaWxsPSIjMDAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5HQVNUT048L3RleHQ+PC9zdmc+" />
  <h2>RFEM SPEAKER PRO</h2>
  <img class="logo" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjUwIiB2aWV3Qm94PSIwIDAgMTAwIDUwIiBmaWxsPSJ3aGl0ZSI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSI1MCIgZmlsbD0iI0ZGMDAwMCIvPjx0ZXh0IHg9IjUwIiB5PSIzMiIgZm9udC1zaXplPSIyMCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5SRkVNPC90ZXh0Pjwvc3ZnPg==" />

  <button onclick="mostrarFormularioNuevo()">â• Piloto</button>
  <button onclick="mostrarRanking()">ğŸ“Š Ranking</button>
  <button onclick="exportarBackup()">â˜ï¸ Backup</button>
  <button onclick="importarBackup()">ğŸ“¥ Restaurar</button>

  <input class="search-box" id="buscador" placeholder="Buscar..." oninput="render()">
</header>

<h2 class="section-title">ğŸ“‹ InformaciÃ³n General</h2>
<div class="grid" id="infoGeneral"></div>

<h2 class="section-title">ğŸ Parrilla de salida</h2>
<div class="grid" id="gridParrilla"></div>

<h2 class="section-title">ğŸ® En pista</h2>
<div class="grid" id="gridPista"></div>

<h2 class="section-title">ğŸ‘¥ Todos los pilotos</h2>
<div class="grid" id="grid"></div>

<!-- FORMULARIO PILOTO -->
<div id="formulario" class="overlay">
  <button onclick="cerrarFormulario()">â¬… Volver</button>
  <h2>Nuevo Piloto</h2>

  <input id="n-nombre" placeholder="Nombre completo">
  <input id="n-piloto2" placeholder="Piloto 2 (opcional)">
  <input id="n-dorsal" placeholder="Dorsal">
  <select id="n-categoria">
    <option value="">Selecciona categorÃ­a</option>
    <option>Jet Ski GP4</option>
    <option>Runabout GP0</option>
    <option>Runabout GP0 FÃ©minas</option>
    <option>Runabout GP0 Junior</option>
    <option>Runabout GP4</option>
    <option>Runabout GP2</option>
    <option>Runabout GP1</option>
    <option>Runabout GP3 F2 AtmosfÃ©ricas</option>
    <option>Runabout GP3 F1 AtmosfÃ©ricas</option>
    <option>Runabout GP2 Promotion</option>
    <option>Deporte Inclusivo</option>
    <option>PN Endurance Race</option>
    <option>Barcos T-850/GT60</option>
    <option>Barcos GT15</option>
    <option>CategorÃ­a 3.5 CC</option>
    <option>CategorÃ­a 7.5 CC</option>
    <option>CategorÃ­a 15 CC</option>
    <option>CategorÃ­a 35 CC</option>
  </select>
  <input id="n-club" placeholder="Club">
  <input id="n-embarcacion" placeholder="EmbarcaciÃ³n">
  <textarea id="n-observaciones" placeholder="Observaciones / informaciÃ³n relevante"></textarea>
  <input type="file" id="n-foto" accept="image/*">

  <button onclick="guardarFormulario()">ğŸ’¾ Guardar</button>
</div>

<!-- FICHA -->
<div id="ficha" class="overlay">
  <button onclick="cerrarFicha()">â¬… Volver</button>
  <button onclick="editarPiloto()">âœï¸ Editar</button>
  <button onclick="eliminarPiloto()" style="background:#ff0033">ğŸ—‘ï¸ Eliminar</button>

  <h2 id="f-nombre"></h2>
  <img id="f-foto" style="width:200px;border-radius:12px;margin-bottom:10px">
  <p id="f-dorsal"></p>
  <p id="f-categoria"></p>
  <p id="f-club"></p>
  <p id="f-embarcacion"></p>

  <h3>ğŸ“ Observaciones</h3>
  <p id="f-observaciones"></p>

  <button onclick="toggleEnPista()">ğŸ® En pista</button>
  <button onclick="toggleParrilla(seleccionado)">ğŸ Parrilla</button>

  <h3>ğŸ† Resultados por categorÃ­a y aÃ±o</h3>
  <div id="f-resultados"></div>

  <button onclick="mostrarResultadoForm()">â• AÃ±adir resultado</button>
</div>

<!-- RESULTADO -->
<div id="resultadoForm" class="overlay">
  <button onclick="cerrarResultadoForm()">â¬… Volver</button>
  <h2>Nuevo Resultado</h2>
  <input id="r-anio" placeholder="AÃ±o">
  <input id="r-competicion" placeholder="CompeticiÃ³n">
  <input id="r-categoria" placeholder="CategorÃ­a">
  <input id="r-puesto" placeholder="Puesto">
  <input id="r-titulo" placeholder="TÃ­tulo">
  <button onclick="guardarResultado()">ğŸ’¾ Guardar</button>
</div>

<script>
let competidores = JSON.parse(localStorage.getItem("rfemData")) || [];
let seleccionado = null;

function guardarDatos() {
  localStorage.setItem("rfemData", JSON.stringify(competidores));
}

function render() {
  guardarDatos();
  ["grid","gridParrilla","gridPista"].forEach(id => {
    document.getElementById(id).innerHTML = "";
  });

  const q = document.getElementById("buscador").value.toLowerCase();

  competidores.forEach((p,i)=>{
    if(q && !p.nombre.toLowerCase().includes(q)) return;

    const card = crearCard(p,i);
    document.getElementById("grid").appendChild(card);

    if(p.enParrilla)
      document.getElementById("gridParrilla").appendChild(crearCard(p,i));
    if(p.enPista)
      document.getElementById("gridPista").appendChild(crearCard(p,i));
  });
}

function crearCard(p,i){
  const c = document.createElement("div");
  c.className = "card"+(p.enPista?" en-pista":"");
  c.innerHTML = `
    <img src="${p.foto || 'https://via.placeholder.com/300x200?text=Piloto'}">
    <strong>${p.nombre}</strong><br>
    ğŸ·ï¸ ${p.dorsal || ""}<br>
    ğŸ“Š ${p.categoria || ""}
    <br><br>
    <button onclick="toggleParrilla(${i});event.stopPropagation()">
      ${p.enParrilla?"â– Parrilla":"â• Parrilla"}
    </button>
  `;
  c.onclick = ()=>abrirFicha(i);
  return c;
}

function mostrarFormularioNuevo(){
  document.getElementById("formulario").style.display="block";
}

function guardarFormulario(){
  const file=document.getElementById("n-foto").files[0];
  const reader=new FileReader();
  reader.onload=e=>{
    competidores.push({
      nombre:n("n-nombre"),
      dorsal:n("n-dorsal"),
      categoria:n("n-categoria"),
      club:n("n-club"),
      embarcacion:n("n-embarcacion"),
      observaciones:n("n-observaciones"),
      foto:e.target.result,
      resultados:[],
      enPista:false,
      enParrilla:false
    });
    cerrarFormulario();
    render();
  };
  if(file) reader.readAsDataURL(file);
  else reader.onload({target:{result:""}});
}

function abrirFicha(i){
  seleccionado=i;
  const p=competidores[i];
  f("f-nombre",p.nombre);
  document.getElementById("f-foto").src=p.foto||"https://via.placeholder.com/300x200";
  f("f-dorsal","Dorsal: "+(p.dorsal||""));
  f("f-categoria","CategorÃ­a: "+(p.categoria||""));
  f("f-club","Club: "+(p.club||""));
  f("f-embarcacion","EmbarcaciÃ³n: "+(p.embarcacion||""));
  f("f-observaciones",p.observaciones||"â€”");

  const r=document.getElementById("f-resultados");
  r.innerHTML="";
  p.resultados.forEach(res=>{
    r.innerHTML+=`<div>ğŸ“… ${res.anio} | ğŸ“Š ${res.categoria} | ğŸ ${res.competicion} | ğŸ† ${res.titulo||""}</div>`;
  });

  document.getElementById("ficha").style.display="block";
}

function guardarResultado(){
  competidores[seleccionado].resultados.push({
    anio:n("r-anio"),
    competicion:n("r-competicion"),
    categoria:n("r-categoria"),
    puesto:n("r-puesto"),
    titulo:n("r-titulo")
  });
  cerrarResultadoForm();
  render();
  abrirFicha(seleccionado);
}

function toggleParrilla(i){
  competidores[i].enParrilla=!competidores[i].enParrilla;
  render();
}

function toggleEnPista(){
  competidores[seleccionado].enPista=!competidores[seleccionado].enPista;
  render();
}

function cerrarFormulario(){
  document.getElementById("formulario").style.display="none";
}

function cerrarFicha(){
  document.getElementById("ficha").style.display="none";
}

function cerrarResultadoForm(){
  document.getElementById("resultadoForm").style.display="none";
}

function mostrarResultadoForm(){
  document.getElementById("resultadoForm").style.display="block";
}

function mostrarRanking(){
  let lista=competidores.map(p=>{
    let pts=0;
    p.resultados.forEach(r=>{
      if(r.puesto=="1") pts+=100;
      else if(r.puesto=="2") pts+=70;
      else if(r.puesto=="3") pts+=50;
      else pts+=10;
    });
    return {n:p.nombre,p:pts};
  }).sort((a,b)=>b.p-a.p);

  alert(lista.map((p,i)=>`${i+1}. ${p.n} â€” ${p.p}`).join("\n"));
}

function exportarBackup(){
  const b=new Blob([JSON.stringify(competidores,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="rfem_backup.json";
  a.click();
}

function importarBackup(){
  const i=document.createElement("input");
  i.type="file";
  i.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{
      competidores=JSON.parse(r.result);
      render();
    };
    r.readAsText(e.target.files[0]);
  };
  i.click();
}

function n(id){return document.getElementById(id).value;}
function f(id,t){document.getElementById(id).innerText=t;}

render();
</script>

</body>
</html>
