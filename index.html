<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>RFEM Speaker PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --azul: #1ec8ff;
  --fondo1: #0f2027;
  --fondo2: #203a43;
  --fondo3: #2c5364;
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, var(--fondo1), var(--fondo2), var(--fondo3));
  color: #fff;
}

header {
  padding: 16px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  background: rgba(0,0,0,0.35);
  backdrop-filter: blur(6px);
}

button {
  background: var(--azul);
  border: none;
  padding: 12px 16px;
  font-weight: bold;
  border-radius: 14px;
  cursor: pointer;
}
button:hover { opacity: 0.85; }

.search-box {
  padding: 12px;
  border-radius: 14px;
  border: none;
  min-width: 240px;
}

.section-title {
  text-align: center;
  font-size: 26px;
  margin: 20px 0 10px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 14px;
  padding: 20px;
}

.card {
  background: rgba(0,0,0,0.45);
  border-radius: 18px;
  padding: 10px;
  text-align: center;
  cursor: pointer;
}
.card.en-pista {
  outline: 4px solid #00ff88;
}

.card img {
  width: 100%;
  height: 140px;
  object-fit: cover;
  border-radius: 12px;
  background: #111;
}

.dorsal {
  font-size: 28px;
  font-weight: bold;
  color: var(--azul);
}

.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.92);
  display: none;
  padding: 20px;
  overflow-y: auto;
  z-index: 999;
}

input, textarea {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 10px;
  border: none;
}

textarea { min-height: 90px; }

.footer {
  display: flex;
  justify-content: center;
  gap: 40px;
  padding: 16px;
  background: rgba(0,0,0,0.5);
}
.footer img {
  height: 48px;
  object-fit: contain;
}
</style>
</head>

<body>

<header>
  <button onclick="nuevoPiloto()">‚ûï Nuevo piloto</button>
  <button onclick="mostrarRanking()">üèÜ Ranking</button>
  <input id="buscador" class="search-box" placeholder="Buscar piloto o dorsal" oninput="render()">
</header>

<h1 class="section-title">üéÆ PILOTOS EN PISTA</h1>
<div class="grid" id="gridPista"></div>

<h1 class="section-title">üèÅ TODOS LOS PILOTOS</h1>
<div class="grid" id="grid"></div>

<!-- FORMULARIO -->
<div id="formulario" class="overlay">
  <button onclick="cerrarFormulario()">‚¨Ö Volver</button>
  <h2>Ficha piloto</h2>

  <input id="f-nombre" placeholder="Piloto 1">
  <input id="f-piloto2" placeholder="Piloto 2 (opcional)">
  <input id="f-dorsal" placeholder="Dorsal">
  <input id="f-categoria" placeholder="Categor√≠a principal">
  <input id="f-club" placeholder="Club">
  <input id="f-embarcacion" placeholder="Embarcaci√≥n">
  <textarea id="f-observaciones" placeholder="Observaciones para speaker"></textarea>
  <input type="file" id="f-foto" accept="image/*">

  <button onclick="guardarPiloto()">üíæ Guardar</button>
</div>

<!-- FICHA -->
<div id="ficha" class="overlay">
  <button onclick="cerrarFicha()">‚¨Ö Volver</button>
  <button onclick="editarPiloto()">‚úèÔ∏è Editar</button>
  <button onclick="eliminarPiloto()" style="background:#ff3344">üóëÔ∏è Eliminar</button>

  <h2 id="v-nombre"></h2>
  <p id="v-info"></p>
  <p id="v-obs"></p>

  <button onclick="toggleEnPista()">üéÆ En pista</button>
</div>

<div class="footer">
  <img src="logo-rfem.png" onerror="this.style.display='none'">
  <img src="logo-uim.png" onerror="this.style.display='none'">
</div>

<script>
let pilotos = JSON.parse(localStorage.getItem("rfem_pilotos")) || [];
let seleccionado = null;
let editando = null;

function guardarLS() {
  localStorage.setItem("rfem_pilotos", JSON.stringify(pilotos));
}

function nuevoPiloto() {
  editando = null;
  document.getElementById("formulario").style.display = "block";
}

function guardarPiloto() {
  const file = document.getElementById("f-foto").files[0];
  const reader = new FileReader();
  reader.onload = e => finalizarGuardado(e.target.result);
  if (file) reader.readAsDataURL(file);
  else finalizarGuardado(null);
}

function finalizarGuardado(foto) {
  const data = {
    nombre: f("f-nombre"),
    piloto2: f("f-piloto2"),
    dorsal: f("f-dorsal"),
    categoria: f("f-categoria"),
    club: f("f-club"),
    embarcacion: f("f-embarcacion"),
    observaciones: f("f-observaciones"),
    foto: foto || "",
    enPista: false
  };

  if (editando !== null) pilotos[editando] = { ...pilotos[editando], ...data };
  else pilotos.push(data);

  cerrarFormulario();
  render();
}

function render() {
  guardarLS();
  const grid = document.getElementById("grid");
  const pista = document.getElementById("gridPista");
  grid.innerHTML = pista.innerHTML = "";

  const q = document.getElementById("buscador").value.toLowerCase();

  pilotos.forEach((p, i) => {
    if (q && !p.nombre.toLowerCase().includes(q) && !p.dorsal.includes(q)) return;
    const c = document.createElement("div");
    c.className = "card" + (p.enPista ? " en-pista" : "");
    c.innerHTML = `
      <img src="${p.foto}">
      <div>${p.nombre}</div>
      <div class="dorsal">${p.dorsal}</div>
      <div>${p.categoria}</div>
    `;
    c.onclick = () => abrirFicha(i);
    (p.enPista ? pista : grid).appendChild(c);
  });
}

function abrirFicha(i) {
  seleccionado = i;
  const p = pilotos[i];
  document.getElementById("v-nombre").innerText = p.nombre;
  document.getElementById("v-info").innerText =
    `Dorsal ${p.dorsal} ¬∑ ${p.categoria} ¬∑ ${p.embarcacion}`;
  document.getElementById("v-obs").innerText = p.observaciones || "";
  document.getElementById("ficha").style.display = "block";
}

function editarPiloto() {
  editando = seleccionado;
  const p = pilotos[editando];
  set("f-nombre", p.nombre);
  set("f-piloto2", p.piloto2);
  set("f-dorsal", p.dorsal);
  set("f-categoria", p.categoria);
  set("f-club", p.club);
  set("f-embarcacion", p.embarcacion);
  set("f-observaciones", p.observaciones);
  cerrarFicha();
  document.getElementById("formulario").style.display = "block";
}

function toggleEnPista() {
  pilotos[seleccionado].enPista = !pilotos[seleccionado].enPista;
  cerrarFicha();
  render();
}

function eliminarPiloto() {
  if (!confirm("¬øEliminar piloto?")) return;
  pilotos.splice(seleccionado, 1);
  cerrarFicha();
  render();
}

function mostrarRanking() {
  alert("Ranking b√°sico (demo PRO)");
}

function cerrarFormulario() {
  document.getElementById("formulario").style.display = "none";
}
function cerrarFicha() {
  document.getElementById("ficha").style.display = "none";
}
function f(id){return document.getElementById(id).value;}
function set(id,v){document.getElementById(id).value=v;}

render();
</script>

</body>
</html>
