<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>RFEM Speaker PRO â€“ Evento</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:linear-gradient(135deg,#051937,#003973,#0077b6);
  color:white;
}

header{
  padding:20px;
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(10px);
}

header img{height:50px}

button{
  background:#00d1ff;
  border:none;
  padding:14px 18px;
  font-size:16px;
  font-weight:bold;
  border-radius:14px;
  cursor:pointer;
}
button:hover{background:#00b4dd}

.search-box{
  padding:12px;
  border-radius:14px;
  border:none;
  font-size:16px;
}

.section-title{
  text-align:center;
  font-size:28px;
  margin:20px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:16px;
  padding:20px;
}

@media(max-width:1400px){.grid{grid-template-columns:repeat(4,1fr)}}
@media(max-width:1024px){.grid{grid-template-columns:repeat(3,1fr)}}
@media(max-width:600px){.grid{grid-template-columns:repeat(2,1fr)}}

.card{
  background:rgba(20,30,60,.9);
  border-radius:20px;
  padding:14px;
  text-align:center;
  cursor:pointer;
}

.en-pista{
  border:4px solid #00ff00;
  box-shadow:0 0 20px #00ff00;
}

.card img{
  width:100%;
  height:140px;
  object-fit:cover;
  border-radius:14px;
  background:#000;
}

.dorsal{font-size:30px;font-weight:bold}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(5,10,25,.97);
  display:none;
  padding:20px;
  overflow-y:auto;
  z-index:999;
}

input,textarea{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border-radius:10px;
  border:none;
  font-size:16px;
}

.footer{
  display:flex;
  justify-content:center;
  gap:40px;
  padding:20px;
  background:rgba(0,0,0,.6);
}
.footer img{height:60px}
</style>
</head>

<body>

<header>
  <img src="logo-gaston.png">
  <strong style="font-size:24px">RFEM SPEAKER PRO</strong>
  <img src="logo-rfem.png">

  <button onclick="nuevoPiloto()">â• Piloto</button>
  <button onclick="exportarBackup()">â˜ï¸ Backup</button>
  <button onclick="importarBackup()">â˜ï¸ Restaurar</button>

  <input id="buscador" class="search-box" placeholder="Buscar piloto o dorsal" oninput="render()">
</header>

<h1 class="section-title">ğŸ® PILOTOS EN PISTA</h1>
<div class="grid" id="gridPista"></div>

<h1 class="section-title">ğŸ TODOS LOS PILOTOS</h1>
<div class="grid" id="grid"></div>

<!-- FORMULARIO -->
<div id="formulario" class="overlay">
  <button onclick="cerrarFormulario()">â¬… Volver</button>
  <h2>Piloto</h2>

  <input id="n-nombre" placeholder="Nombre">
  <input id="n-piloto2" placeholder="Piloto 2">
  <input id="n-dorsal" placeholder="Dorsal">
  <input id="n-categoria" placeholder="CategorÃ­a">
  <input id="n-club" placeholder="Club">
  <input id="n-embarcacion" placeholder="EmbarcaciÃ³n">
  <textarea id="n-observaciones" placeholder="Observaciones"></textarea>
  <input type="file" id="n-foto" accept="image/*">

  <button onclick="guardarPiloto()">ğŸ’¾ Guardar</button>
</div>

<!-- FICHA -->
<div id="ficha" class="overlay">
  <button onclick="cerrarFicha()">â¬… Volver</button>
  <button onclick="editarPiloto()">âœï¸ Editar</button>
  <button onclick="eliminarPiloto()" style="background:#ff0033">ğŸ—‘ï¸ Eliminar</button>

  <h2 id="f-nombre"></h2>
  <p id="f-dorsal"></p>
  <p id="f-categoria"></p>
  <p id="f-observaciones"></p>

  <button onclick="toggleEnPista()">ğŸ® En pista / Quitar</button>
</div>

<div class="footer">
  <img src="logo-gaston.png">
  <img src="logo-rfem.png">
  <img src="logo-andalucia.png">
  <img src="logo-uim.png">
</div>

<script>
let competidores = JSON.parse(localStorage.getItem("rfemData")) || [];
let seleccionado = null;
let editando = null;

function guardarDatos(){
  localStorage.setItem("rfemData",JSON.stringify(competidores));
}

function render(){
  guardarDatos();
  grid.innerHTML="";
  gridPista.innerHTML="";
  const q=buscador.value.toLowerCase();

  competidores.forEach((p,i)=>{
    if(q && !p.nombre.toLowerCase().includes(q) && !p.dorsal.includes(q)) return;
    const c=card(p,i);
    grid.appendChild(c);
    if(p.enPista) gridPista.appendChild(card(p,i));
  });
}

function card(p,i){
  const d=document.createElement("div");
  d.className="card"+(p.enPista?" en-pista":"");
  d.innerHTML=`
    <img src="${p.foto||""}">
    <div>${p.nombre}</div>
    <div class="dorsal">${p.dorsal}</div>
    <div>${p.categoria||""}</div>`;
  d.onclick=()=>abrirFicha(i);
  return d;
}

function nuevoPiloto(){
  editando=null;
  limpiarForm();
  formulario.style.display="block";
}

function editarPiloto(){
  editando=seleccionado;
  const p=competidores[editando];
  set("n-nombre",p.nombre);
  set("n-piloto2",p.piloto2);
  set("n-dorsal",p.dorsal);
  set("n-categoria",p.categoria);
  set("n-club",p.club);
  set("n-embarcacion",p.embarcacion);
  set("n-observaciones",p.observaciones);
  formulario.style.display="block";
  ficha.style.display="none";
}

function guardarPiloto(){
  const base = editando!==null ? competidores[editando] : {enPista:false,foto:""};
  base.nombre=val("n-nombre");
  base.piloto2=val("n-piloto2");
  base.dorsal=val("n-dorsal");
  base.categoria=val("n-categoria");
  base.club=val("n-club");
  base.embarcacion=val("n-embarcacion");
  base.observaciones=val("n-observaciones");

  const f=document.getElementById("n-foto").files[0];
  if(f){
    const r=new FileReader();
    r.onload=e=>{base.foto=e.target.result;finalizar(base);}
    r.readAsDataURL(f);
  } else finalizar(base);
}

function finalizar(p){
  if(editando===null) competidores.push(p);
  cerrarFormulario();
  render();
}

function abrirFicha(i){
  seleccionado=i;
  const p=competidores[i];
  txt("f-nombre",p.nombre);
  txt("f-dorsal","Dorsal: "+p.dorsal);
  txt("f-categoria","CategorÃ­a: "+p.categoria);
  txt("f-observaciones",p.observaciones||"â€”");
  ficha.style.display="block";
}

function toggleEnPista(){
  competidores[seleccionado].enPista=!competidores[seleccionado].enPista;
  render();
}

function eliminarPiloto(){
  if(confirm("Â¿Eliminar piloto?")){
    competidores.splice(seleccionado,1);
    cerrarFicha();render();
  }
}

function exportarBackup(){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([JSON.stringify(competidores,null,2)]));
  a.download="rfem_backup.json";
  a.click();
}

function importarBackup(){
  const i=document.createElement("input");
  i.type="file";i.accept="application/json";
  i.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{competidores=JSON.parse(r.result);render();}
    r.readAsText(e.target.files[0]);
  };i.click();
}

function cerrarFormulario(){formulario.style.display="none";}
function cerrarFicha(){ficha.style.display="none";}
function limpiarForm(){
  document.querySelectorAll("#formulario input,textarea").forEach(e=>e.value="");
}
function val(id){return document.getElementById(id).value;}
function set(id,v){document.getElementById(id).value=v||"";}
function txt(id,v){document.getElementById(id).innerText=v;}

render();
</script>

</body>
</html>
