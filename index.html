<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>RFEM Speaker PRO â€“ Modo Evento</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #051937, #003973, #0077b6);
  background-size: cover;
  background-attachment: fixed;
  color: white;
}

/* HEADER */
header {
  padding: 20px;
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  justify-content: center;
  align-items: center;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(10px);
}

header img {
  height: 50px;
}

/* BOTONES */
button {
  background: #00d1ff;
  border: none;
  padding: 14px 18px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 14px;
  cursor: pointer;
  transition: transform 0.2s, background 0.2s;
}
button:hover {
  background: #00b4dd;
  transform: scale(1.05);
}

/* BUSCADOR */
.search-box {
  background: white;
  color: black;
  padding: 12px 16px;
  border-radius: 14px;
  font-size: 16px;
  border: none;
  min-width: 240px;
}

/* SECCIONES */
.section-title {
  text-align: center;
  font-size: 28px;
  margin: 20px;
  text-shadow: 0 0 12px rgba(0,209,255,0.5);
}

/* GRID â€” 5 COLUMNAS FIJAS */
.grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 16px;
  padding: 20px;
}

/* RESPONSIVE */
@media (max-width: 1400px) {
  .grid { grid-template-columns: repeat(4, 1fr); }
}
@media (max-width: 1024px) {
  .grid { grid-template-columns: repeat(3, 1fr); }
}
@media (max-width: 600px) {
  .grid { grid-template-columns: repeat(2, 1fr); }
}

/* TARJETAS */
.card {
  background: rgba(20,30,60,0.9);
  border-radius: 20px;
  padding: 14px;
  text-align: center;
  transition: transform 0.2s, box-shadow 0.2s;
}
.card:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px #00d1ff;
}

.en-pista {
  border: 4px solid #00ff00;
  box-shadow: 0 0 25px #00ff00;
}

.card img {
  width: 100%;
  height: 140px;
  object-fit: cover;
  border-radius: 14px;
  background: #000;
}

.dorsal {
  font-size: 32px;
  font-weight: bold;
}

/* OVERLAYS */
.overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background: rgba(5,10,25,0.97);
  display: none;
  padding: 20px;
  overflow-y: auto;
  z-index: 999;
}

/* INPUTS */
input, select, textarea {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
}

/* INFO GENERAL */
.info-box {
  background: rgba(0,0,0,0.6);
  border-radius: 20px;
  padding: 20px;
  margin: 20px;
}

/* FOOTER */
.footer {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 40px;
  padding: 20px;
  background: rgba(0,0,0,0.6);
}

.footer img {
  height: 60px;
  opacity: 0.9;
}
</style>
</head>

<body>

<header>
  <img src="logo-gaston.png" alt="Logo GastÃ³n">
  <img src="logo-andalucia.png" alt="Logo FAM">
  <strong style="font-size:24px;">RFEM SPEAKER PRO</strong>
  <img src="logo-rfem.png" alt="Logo RFEM">
  <img src="logo-uim.png" alt="Logo UIM">

  <button onclick="mostrarFormularioNuevo()">â• Piloto</button>
  <button onclick="exportarBackup()">â˜ï¸ Backup</button>
  <button onclick="importarBackup()">â˜ï¸ Restaurar</button>

  <input id="buscador" class="search-box" placeholder="ğŸ” Buscar piloto o dorsal" oninput="render()">
</header>

<!-- INFORMACIÃ“N GENERAL -->
<h1 class="section-title">ğŸ“˜ INFORMACIÃ“N GENERAL DEL EVENTO</h1>
<div class="info-box">
  <textarea id="infoGeneral" rows="6" placeholder="Pega aquÃ­ informaciÃ³n clave del campeonato, horarios, reglas, notas del speaker..."></textarea>
  <button onclick="guardarInfo()">ğŸ’¾ Guardar InformaciÃ³n</button>
</div>

<h1 class="section-title">ğŸ PARRILLA DE SALIDA</h1>
<div class="grid" id="gridParrilla"></div>

<h1 class="section-title">ğŸ TODOS LOS COMPETIDORES</h1>
<div class="grid" id="grid"></div>

<!-- FORMULARIO PILOTO -->
<div id="formulario" class="overlay">
  <button onclick="cerrarFormulario()">â¬… Volver</button>
  <h2>Nuevo / Editar Piloto</h2>

  <input id="n-nombre" placeholder="Piloto principal">
  <input id="n-piloto2" placeholder="Piloto 2 (opcional)">
  <input id="n-dorsal" placeholder="Dorsal">
  <input id="n-categoria" placeholder="CategorÃ­a principal">
  <input id="n-club" placeholder="Club / Equipo">
  <input id="n-embarcacion" placeholder="EmbarcaciÃ³n">
  <textarea id="n-observaciones" placeholder="Observaciones / Info relevante del piloto"></textarea>
  <input type="file" id="n-foto" accept="image/*">

  <button onclick="guardarFormulario()">ğŸ’¾ Guardar</button>
</div>

<!-- FICHA PILOTO -->
<div id="ficha" class="overlay">
  <button onclick="cerrarFicha()">â¬… Volver</button>
  <button onclick="editarPiloto()">âœï¸ Editar</button>
  <button onclick="eliminarPiloto()" style="background:#ff0033">ğŸ—‘ï¸ Eliminar</button>

  <h2 id="f-nombre"></h2>
  <p id="f-piloto2"></p>
  <p id="f-dorsal"></p>
  <p id="f-categoria"></p>
  <p id="f-club"></p>
  <p id="f-embarcacion"></p>

  <h3>ğŸ“ Observaciones</h3>
  <p id="f-observaciones"></p>

  <button onclick="toggleEnPista()">ğŸ® En pista</button>
  <button onclick="toggleParrilla(seleccionado)">ğŸ A/Q Parrilla</button>

  <h3>ğŸ“Š Resultados por CategorÃ­a y AÃ±o</h3>
  <div id="f-resultados"></div>
</div>

<div class="footer">
  <img src="logo-gaston.png">
  <img src="logo-rfem.png">
  <img src="logo-andalucia.png">
  <img src="logo-uim.png">
</div>

<script>
let competidores = JSON.parse(localStorage.getItem("rfemData")) || [];
let seleccionado = null;
let editandoIndex = null;

/* INFO GENERAL */
document.getElementById("infoGeneral").value = localStorage.getItem("rfemInfo") || "";

function guardarInfo() {
  localStorage.setItem("rfemInfo", document.getElementById("infoGeneral").value);
  alert("InformaciÃ³n general guardada");
}

/* UTILIDADES */
function guardarDatos() {
  localStorage.setItem("rfemData", JSON.stringify(competidores));
}

function filtroBusqueda(p) {
  const q = document.getElementById("buscador").value.toLowerCase();
  return !q || 
    (p.nombre && p.nombre.toLowerCase().includes(q)) || 
    (p.dorsal && p.dorsal.includes(q));
}

/* RENDER */
function render() {
  guardarDatos();
  const grid = document.getElementById("grid");
  const pista = document.getElementById("gridPista");
  const parrilla = document.getElementById("gridParrilla");

  grid.innerHTML = "";
  pista.innerHTML = "";
  parrilla.innerHTML = "";

  const filtrados = competidores.filter(filtroBusqueda);

  filtrados.forEach((p, i) => {
    if (p.enPista) pista.appendChild(crearCard(p, i));
    if (p.enParrilla) parrilla.appendChild(crearCard(p, i));
    grid.appendChild(crearCard(p, i));
  });
}

/* CARD */
function crearCard(p, index) {
  const card = document.createElement("div");
  card.className = "card" + (p.enPista ? " en-pista" : "");
  card.innerHTML = `
    <img src="${p.foto || ''}">
    <div>${p.nombre}</div>
    <div class="dorsal">${p.dorsal || ""}</div>
    <div>${p.categoria || ""}</div>
  `;
  card.onclick = () => abrirFicha(index);
  return card;
}

/* CRUD */
function mostrarFormularioNuevo() {
  editandoIndex = null;
  limpiarFormulario();
  document.getElementById("formulario").style.display = "block";
}

function guardarFormulario() {
  const file = document.getElementById("n-foto").files[0];
  const reader = new FileReader();
  reader.onload = e => guardarFinal(e.target.result);
  if (file) reader.readAsDataURL(file);
  else guardarFinal(null);
}

function guardarFinal(foto) {
  const obj = {
    nombre: n("n-nombre"),
    piloto2: n("n-piloto2"),
    dorsal: n("n-dorsal"),
    categoria: n("n-categoria"),
    club: n("n-club"),
    embarcacion: n("n-embarcacion"),
    observaciones: n("n-observaciones"),
    resultados: [],
    enPista: false,
    enParrilla: false,
    foto: foto || ""
  };

  if (editandoIndex !== null) {
    competidores[editandoIndex] = obj;
  } else {
    competidores.push(obj);
  }

  cerrarFormulario();
  render();
}

function abrirFicha(i) {
  seleccionado = i;
  const p = competidores[i];

  f("f-nombre", p.nombre);
  f("f-piloto2", "Piloto 2: " + (p.piloto2 || "â€”"));
  f("f-dorsal", "Dorsal: " + p.dorsal);
  f("f-categoria", "CategorÃ­a: " + p.categoria);
  f("f-club", "Club: " + p.club);
  f("f-embarcacion", "EmbarcaciÃ³n: " + p.embarcacion);
  f("f-observaciones", p.observaciones || "â€”");

  const res = document.getElementById("f-resultados");
  res.innerHTML = "";

  p.resultados.forEach(r => {
    res.innerHTML += `
      <div style="margin-bottom:10px;padding:10px;background:#112;border-radius:10px">
        ğŸ—“ï¸ ${r.anio || ""} | ğŸ“Š ${r.categoria || ""}<br>
        ğŸ ${r.competicion || ""}<br>
        ğŸ¥‡ Puesto: ${r.puesto || ""} | ğŸ† ${r.titulo || ""}
      </div>
    `;
  });

  document.getElementById("ficha").style.display = "block";
}

function toggleEnPista() {
  competidores[seleccionado].enPista = !competidores[seleccionado].enPista;
  render();
}

function toggleParrilla(i) {
  competidores[i].enParrilla = !competidores[i].enParrilla;
  render();
}

function eliminarPiloto() {
  if (!confirm("Â¿Eliminar piloto?")) return;
  competidores.splice(seleccionado, 1);
  cerrarFicha();
  render();
}

/* BACKUP */
function exportarBackup() {
  const blob = new Blob([JSON.stringify(competidores,null,2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "rfem_backup.json";
  a.click();
}

function importarBackup() {
  const i = document.createElement("input");
  i.type = "file";
  i.accept = "application/json";
  i.onchange = e => {
    const r = new FileReader();
    r.onload = () => {
      competidores = JSON.parse(r.result);
      render();
    };
    r.readAsText(e.target.files[0]);
  };
  i.click();
}

/* HELPERS */
function cerrarFormulario(){document.getElementById("formulario").style.display="none";}
function cerrarFicha(){document.getElementById("ficha").style.display="none";}
function limpiarFormulario(){
  ["n-nombre","n-piloto2","n-dorsal","n-categoria","n-club","n-embarcacion","n-observaciones"]
  .forEach(id=>v(id,""));
  document.getElementById("n-foto").value="";
}
function n(id){return document.getElementById(id).value;}
function v(id,val){document.getElementById(id).value=val;}
function f(id,txt){document.getElementById(id).innerText=txt;}

render();
</script>

</body>
</html>
